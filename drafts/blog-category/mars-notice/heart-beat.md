心跳方案：



- 心跳有效性：认为连接成功后三次心跳即表示环境正常
- 失败确定性：认为失败多次后才是失败
- 避免临界值：
- 动态调整：

![image-20200818215142507](C:/Users/41675/Desktop/mars-notice/image-20200818215142507.png)



竞品方案：

- whatsApp：结合gcm 省电唤醒，但是不管是gcm 连接还是心跳，一定时长后都会断开。  
- line：大同小异，但是还会有客户端单独建立一个链接发送类心跳请求（请求间隔动态调整）。



推送这块就先不考虑，智能心跳：

- NAT 超时：ip 数量不足，客户端连接网络的时候，需要运营商进行局域网的转发。因此会有一个表的维护，而如果客户端一定时间内没有数据通讯。那么就被从表中移除，造成连接中断。

  

所以心跳要比nat 短。但是nat 又和网络状态有关，比如wifi 和数据网络就不一样，所以需要从一个较短的时间开始增加。

主动操作冗余心跳：点亮屏幕、切换到前台、联网重新连接后  



心跳整体情况的日志



